const getUserSessionChats = async ({ userId, useCase, sessionId }) => {
  const localUseCase = 'Earnings Call Transcript';
  const data = {
    user_id: userId,
    project_type: 'LUMOS',
    user_agent: 'Windows 10',
    session_id: sessionId,
    use_case: localUseCase,
    no_of_chats: 10,
  };

  try {
    const res = await fetch(`${CONFIG.API_BASE_URL}/chats/get_user_session_chats`, {
      method: 'POST',
      body: JSON.stringify(data),
      headers: { 'Content-Type': 'application/json' },
    });

    if (res.ok) {
      return res.json(); // return parsed JSON here directly
    }
  } catch (error) {
    console.error('Error fetching session chats:', error);
  }

  return null;
};

const intervalId = setInterval(async () => {
  try {
    const data = await getUserSessionChats({
      userId,
      useCase,
      sessionId,
    });

    const session = data?.find((item) => item.session_id === sessionId); // ✅ FIXED

    if (session?.status === 'Completed') {
      clearInterval(intervalId);
      dispatch(setToggleBanner(false));
      dispatch(setCurrentProcessingButton(false));
      dispatch(setRefressPreviousSession(true));
      dispatch(setToggleProcessingStatus(false));
      dispatch(toggleChatComponent(true));
      dispatch(setCurrentSessionDetails(session));
      dispatch(setCurrentChat(session.chats));
      dispatch(setToggleCurrentSession(true));
      dispatch(toggleEditContextButton(false));
    }
  } catch (error) {
    console.error('Failed to poll create session:', error);
  }
}, 60000); // ✅ add delay (60 sec)
